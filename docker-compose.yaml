name: tp
services:

  # ============================== RABBITMQ SERVICE ============================== #

  rabbitmq-message-middleware:
    container_name: rabbitmq-message-middleware
    image: "rabbitmq:4-management"
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      - RABBITMQ_DEFAULT_USER=${RABBITMQ_USER}
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASS}
    networks:
      - custom_net
    healthcheck:
      test: rabbitmq-diagnostics check_port_connectivity
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 30s

  # ============================== CLIENT & SERVER SERVICES ============================== #

  client_0:
    container_name: client_0
    image: client:latest
    entrypoint: python3 -m client.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CLIENT_ID=0
      - SERVER_HOST=server
      - SERVER_PORT=5000
      - DATA_PATH=/data
      - RESULTS_PATH=/results
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
    networks:
      - custom_net
    volumes:
      - type: bind
        source: ${LOCAL_DATA_PATH_0}
        target: /data
        read_only: true
      - type: bind
        source: ${LOCAL_RESULTS_PATH}
        target: /results
        read_only: false
    depends_on:
      server:
        condition: service_started

  server:
    container_name: server
    image: server:latest
    entrypoint: python3 -m server.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - SERVER_PORT=5000
      - SERVER_LISTEN_BACKLOG=${SERVER_LISTEN_BACKLOG}
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - MENU_ITEMS_CLN_AMOUNT=1
      - STORES_CLN_AMOUNT=1
      - TRANSACTION_ITEMS_CLN_AMOUNT=2
      - TRANSACTIONS_CLN_AMOUNT=2
      - USERS_CLN_AMOUNT=2
      - Q1X_OB_AMOUNT=2
      - Q21_OB_AMOUNT=1
      - Q22_OB_AMOUNT=1
      - Q3X_OB_AMOUNT=1
      - Q4X_OB_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== CLEANERS SERVICES ============================== #

  menu_items_cleaner_0:
    container_name: menu_items_cleaner_0
    image: menu_items_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.menu_items_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  stores_cleaner_0:
    container_name: stores_cleaner_0
    image: stores_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.stores_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transaction_items_cleaner_0:
    container_name: transaction_items_cleaner_0
    image: transaction_items_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.transaction_items_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transaction_items_cleaner_1:
    container_name: transaction_items_cleaner_1
    image: transaction_items_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.transaction_items_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_cleaner_0:
    container_name: transactions_cleaner_0
    image: transactions_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.transactions_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_cleaner_1:
    container_name: transactions_cleaner_1
    image: transactions_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.transactions_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  users_cleaner_0:
    container_name: users_cleaner_0
    image: users_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.users_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=8
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  users_cleaner_1:
    container_name: users_cleaner_1
    image: users_cleaner:latest
    entrypoint: python3 -m controllers.cleaners.users_cleaner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - NEXT_CONTROLLERS_AMOUNT=8
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== FILTERS SERVICES ============================== #

  filter_transactions_by_year_0:
    container_name: filter_transactions_by_year_0
    image: filter_transactions_by_year:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_year.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=6
      - YEARS_TO_KEEP=2024,2025
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_year_1:
    container_name: filter_transactions_by_year_1
    image: filter_transactions_by_year:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_year.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=6
      - YEARS_TO_KEEP=2024,2025
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_hour_0:
    container_name: filter_transactions_by_hour_0
    image: filter_transactions_by_hour:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_hour.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_HOUR=6
      - MAX_HOUR=23
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_hour_1:
    container_name: filter_transactions_by_hour_1
    image: filter_transactions_by_hour:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_hour.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_HOUR=6
      - MAX_HOUR=23
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_hour_2:
    container_name: filter_transactions_by_hour_2
    image: filter_transactions_by_hour:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_hour.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=2
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_HOUR=6
      - MAX_HOUR=23
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_hour_3:
    container_name: filter_transactions_by_hour_3
    image: filter_transactions_by_hour:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_hour.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=3
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_HOUR=6
      - MAX_HOUR=23
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_hour_4:
    container_name: filter_transactions_by_hour_4
    image: filter_transactions_by_hour:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_hour.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=4
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_HOUR=6
      - MAX_HOUR=23
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_hour_5:
    container_name: filter_transactions_by_hour_5
    image: filter_transactions_by_hour:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_hour.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=5
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_HOUR=6
      - MAX_HOUR=23
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_final_amount_0:
    container_name: filter_transactions_by_final_amount_0
    image: filter_transactions_by_final_amount:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_final_amount.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=6
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_FINAL_AMOUNT=75.0
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transactions_by_final_amount_1:
    container_name: filter_transactions_by_final_amount_1
    image: filter_transactions_by_final_amount:latest
    entrypoint: python3 -m controllers.filters.filter_transactions_by_final_amount.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=6
      - NEXT_CONTROLLERS_AMOUNT=2
      - MIN_FINAL_AMOUNT=75.0
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transaction_items_by_year_0:
    container_name: filter_transaction_items_by_year_0
    image: filter_transaction_items_by_year:latest
    entrypoint: python3 -m controllers.filters.filter_transaction_items_by_year.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - YEARS_TO_KEEP=2024,2025
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  filter_transaction_items_by_year_1:
    container_name: filter_transaction_items_by_year_1
    image: filter_transaction_items_by_year:latest
    entrypoint: python3 -m controllers.filters.filter_transaction_items_by_year.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - YEARS_TO_KEEP=2024,2025
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== MAPPERS SERVICES ============================== #

  year_month_created_at_transaction_items_mapper_0:
    container_name: year_month_created_at_transaction_items_mapper_0
    image: year_month_created_at_transaction_items_mapper:latest
    entrypoint: python3 -m controllers.mappers.year_month_created_at_transaction_items_mapper.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  year_month_created_at_transaction_items_mapper_1:
    container_name: year_month_created_at_transaction_items_mapper_1
    image: year_month_created_at_transaction_items_mapper:latest
    entrypoint: python3 -m controllers.mappers.year_month_created_at_transaction_items_mapper.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  year_half_created_at_transactions_mapper_0:
    container_name: year_half_created_at_transactions_mapper_0
    image: year_half_created_at_transactions_mapper:latest
    entrypoint: python3 -m controllers.mappers.year_half_created_at_transactions_mapper.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=6
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  year_half_created_at_transactions_mapper_1:
    container_name: year_half_created_at_transactions_mapper_1
    image: year_half_created_at_transactions_mapper:latest
    entrypoint: python3 -m controllers.mappers.year_half_created_at_transactions_mapper.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=6
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== REDUCERS SERVICES ============================== #

  sellings_qty_by_item_id_and_year_month_created_at_reducer_0:
    container_name: sellings_qty_by_item_id_and_year_month_created_at_reducer_0
    image: sellings_qty_by_item_id_and_year_month_created_at_reducer:latest
    entrypoint: python3 -m controllers.reducers.sellings_qty_by_item_id_and_year_month_created_at_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=1
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  sellings_qty_by_item_id_and_year_month_created_at_reducer_1:
    container_name: sellings_qty_by_item_id_and_year_month_created_at_reducer_1
    image: sellings_qty_by_item_id_and_year_month_created_at_reducer:latest
    entrypoint: python3 -m controllers.reducers.sellings_qty_by_item_id_and_year_month_created_at_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=1
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  profit_sum_by_item_id_and_year_month_created_at_reducer_0:
    container_name: profit_sum_by_item_id_and_year_month_created_at_reducer_0
    image: profit_sum_by_item_id_and_year_month_created_at_reducer:latest
    entrypoint: python3 -m controllers.reducers.profit_sum_by_item_id_and_year_month_created_at_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=1
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  profit_sum_by_item_id_and_year_month_created_at_reducer_1:
    container_name: profit_sum_by_item_id_and_year_month_created_at_reducer_1
    image: profit_sum_by_item_id_and_year_month_created_at_reducer:latest
    entrypoint: python3 -m controllers.reducers.profit_sum_by_item_id_and_year_month_created_at_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=1
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  tpv_by_store_id_and_year_half_created_at_reducer_0:
    container_name: tpv_by_store_id_and_year_half_created_at_reducer_0
    image: tpv_by_store_id_and_year_half_created_at_reducer:latest
    entrypoint: python3 -m controllers.reducers.tpv_by_store_id_and_year_half_created_at_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  purchases_qty_by_store_id_and_user_id_reducer_0:
    container_name: purchases_qty_by_store_id_and_user_id_reducer_0
    image: purchases_qty_by_store_id_and_user_id_reducer:latest
    entrypoint: python3 -m controllers.reducers.purchases_qty_by_store_id_and_user_id_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  purchases_qty_by_store_id_and_user_id_reducer_1:
    container_name: purchases_qty_by_store_id_and_user_id_reducer_1
    image: purchases_qty_by_store_id_and_user_id_reducer:latest
    entrypoint: python3 -m controllers.reducers.purchases_qty_by_store_id_and_user_id_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  purchases_qty_by_store_id_and_user_id_reducer_2:
    container_name: purchases_qty_by_store_id_and_user_id_reducer_2
    image: purchases_qty_by_store_id_and_user_id_reducer:latest
    entrypoint: python3 -m controllers.reducers.purchases_qty_by_store_id_and_user_id_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=2
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  purchases_qty_by_store_id_and_user_id_reducer_3:
    container_name: purchases_qty_by_store_id_and_user_id_reducer_3
    image: purchases_qty_by_store_id_and_user_id_reducer:latest
    entrypoint: python3 -m controllers.reducers.purchases_qty_by_store_id_and_user_id_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=3
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  purchases_qty_by_store_id_and_user_id_reducer_4:
    container_name: purchases_qty_by_store_id_and_user_id_reducer_4
    image: purchases_qty_by_store_id_and_user_id_reducer:latest
    entrypoint: python3 -m controllers.reducers.purchases_qty_by_store_id_and_user_id_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=4
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  purchases_qty_by_store_id_and_user_id_reducer_5:
    container_name: purchases_qty_by_store_id_and_user_id_reducer_5
    image: purchases_qty_by_store_id_and_user_id_reducer:latest
    entrypoint: python3 -m controllers.reducers.purchases_qty_by_store_id_and_user_id_reducer.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=5
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== SORTERS SERVICES ============================== #

  desc_by_year_month_created_at_and_sellings_qty_sorter_0:
    container_name: desc_by_year_month_created_at_and_sellings_qty_sorter_0
    image: desc_by_year_month_created_at_and_sellings_qty_sorter:latest
    entrypoint: python3 -m controllers.sorters.desc_by_year_month_created_at_and_sellings_qty_sorter.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - AMOUNT_PER_GROUP=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  desc_by_year_month_created_at_and_profit_sum_sorter_0:
    container_name: desc_by_year_month_created_at_and_profit_sum_sorter_0
    image: desc_by_year_month_created_at_and_profit_sum_sorter:latest
    entrypoint: python3 -m controllers.sorters.desc_by_year_month_created_at_and_profit_sum_sorter.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - AMOUNT_PER_GROUP=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  desc_by_store_id_and_purchases_qty_sorter_0:
    container_name: desc_by_store_id_and_purchases_qty_sorter_0
    image: desc_by_store_id_and_purchases_qty_sorter:latest
    entrypoint: python3 -m controllers.sorters.desc_by_store_id_and_purchases_qty_sorter.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=6
      - NEXT_CONTROLLERS_AMOUNT=8
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - AMOUNT_PER_GROUP=3
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  desc_by_store_id_and_purchases_qty_sorter_1:
    container_name: desc_by_store_id_and_purchases_qty_sorter_1
    image: desc_by_store_id_and_purchases_qty_sorter:latest
    entrypoint: python3 -m controllers.sorters.desc_by_store_id_and_purchases_qty_sorter.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=6
      - NEXT_CONTROLLERS_AMOUNT=8
      - BATCH_MAX_SIZE=${BATCH_MAX_SIZE}
      - AMOUNT_PER_GROUP=3
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== JOINERS SERVICES ============================== #

  transaction_items_with_menu_items_query_21_joiner_0:
    container_name: transaction_items_with_menu_items_query_21_joiner_0
    image: transaction_items_with_menu_items_query_21_joiner:latest
    entrypoint: python3 -m controllers.joiners.transaction_items_with_menu_items_joiner.transaction_items_with_menu_items_query_21_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=1
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transaction_items_with_menu_items_query_21_joiner_1:
    container_name: transaction_items_with_menu_items_query_21_joiner_1
    image: transaction_items_with_menu_items_query_21_joiner:latest
    entrypoint: python3 -m controllers.joiners.transaction_items_with_menu_items_joiner.transaction_items_with_menu_items_query_21_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=1
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transaction_items_with_menu_items_query_22_joiner_0:
    container_name: transaction_items_with_menu_items_query_22_joiner_0
    image: transaction_items_with_menu_items_query_22_joiner:latest
    entrypoint: python3 -m controllers.joiners.transaction_items_with_menu_items_joiner.transaction_items_with_menu_items_query_22_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=1
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transaction_items_with_menu_items_query_22_joiner_1:
    container_name: transaction_items_with_menu_items_query_22_joiner_1
    image: transaction_items_with_menu_items_query_22_joiner:latest
    entrypoint: python3 -m controllers.joiners.transaction_items_with_menu_items_joiner.transaction_items_with_menu_items_query_22_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=1
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_stores_query_3x_joiner_0:
    container_name: transactions_with_stores_query_3x_joiner_0
    image: transactions_with_stores_query_3x_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_stores_joiner.transactions_with_stores_query_3x_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=1
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_stores_query_3x_joiner_1:
    container_name: transactions_with_stores_query_3x_joiner_1
    image: transactions_with_stores_query_3x_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_stores_joiner.transactions_with_stores_query_3x_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=1
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_stores_query_4x_joiner_0:
    container_name: transactions_with_stores_query_4x_joiner_0
    image: transactions_with_stores_query_4x_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_stores_joiner.transactions_with_stores_query_4x_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=8
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_stores_query_4x_joiner_1:
    container_name: transactions_with_stores_query_4x_joiner_1
    image: transactions_with_stores_query_4x_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_stores_joiner.transactions_with_stores_query_4x_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=1
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=8
      - NEXT_CONTROLLERS_AMOUNT=1
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_0:
    container_name: transactions_with_users_joiner_0
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_1:
    container_name: transactions_with_users_joiner_1
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_2:
    container_name: transactions_with_users_joiner_2
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=2
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_3:
    container_name: transactions_with_users_joiner_3
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=3
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_4:
    container_name: transactions_with_users_joiner_4
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=4
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_5:
    container_name: transactions_with_users_joiner_5
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=5
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_6:
    container_name: transactions_with_users_joiner_6
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=6
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  transactions_with_users_joiner_7:
    container_name: transactions_with_users_joiner_7
    image: transactions_with_users_joiner:latest
    entrypoint: python3 -m controllers.joiners.transactions_with_users_joiner.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=7
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - BASE_DATA_PREV_CONTROLLERS_AMOUNT=2
      - STREAM_DATA_PREV_CONTROLLERS_AMOUNT=2
      - NEXT_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== OUTPUT BUILDERS SERVICES ============================== #

  query_1x_output_builder_0:
    container_name: query_1x_output_builder_0
    image: query_1x_output_builder:latest
    entrypoint: python3 -m controllers.output_builders.query_1x_output_builder.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  query_1x_output_builder_1:
    container_name: query_1x_output_builder_1
    image: query_1x_output_builder:latest
    entrypoint: python3 -m controllers.output_builders.query_1x_output_builder.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=1
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  query_21_output_builder_0:
    container_name: query_21_output_builder_0
    image: query_21_output_builder:latest
    entrypoint: python3 -m controllers.output_builders.query_21_output_builder.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  query_22_output_builder_0:
    container_name: query_22_output_builder_0
    image: query_22_output_builder:latest
    entrypoint: python3 -m controllers.output_builders.query_22_output_builder.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  query_3x_output_builder_0:
    container_name: query_3x_output_builder_0
    image: query_3x_output_builder:latest
    entrypoint: python3 -m controllers.output_builders.query_3x_output_builder.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  query_4x_output_builder_0:
    container_name: query_4x_output_builder_0
    image: query_4x_output_builder:latest
    entrypoint: python3 -m controllers.output_builders.query_4x_output_builder.main
    environment:
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - CONTROLLER_ID=0
      - RABBITMQ_HOST=rabbitmq-message-middleware
      - PREV_CONTROLLERS_AMOUNT=2
      - HEALTH_LISTEN_PORT=9201
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  # ============================== HEALTH CHECKERS SERVICES ============================== #

  hc_0:
    container_name: hc_0
    image: health_checkers:latest
    volumes: 
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ID=0
      - NODE_NAME=hc_0
      - LISTEN_PORT=9101
      - HEALTH_LISTEN_PORT=9201
      - RING_PEERS=hc_1,hc_2,hc_3,hc_4
      - CONTROLLER_TARGETS=server,menu_items_cleaner_0,stores_cleaner_0,transaction_items_cleaner_0,transaction_items_cleaner_1,transactions_cleaner_0,transactions_cleaner_1,users_cleaner_0,users_cleaner_1,filter_transactions_by_year_0,filter_transactions_by_year_1,filter_transactions_by_hour_0,filter_transactions_by_hour_1,filter_transactions_by_hour_2,filter_transactions_by_hour_3,filter_transactions_by_hour_4,filter_transactions_by_hour_5,filter_transactions_by_final_amount_0,filter_transactions_by_final_amount_1,filter_transaction_items_by_year_0,filter_transaction_items_by_year_1,year_month_created_at_transaction_items_mapper_0,year_month_created_at_transaction_items_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,sellings_qty_by_item_id_and_year_month_created_at_reducer_0,profit_sum_by_item_id_and_year_month_created_at_reducer_0,sellings_qty_by_item_id_and_year_month_created_at_reducer_1,profit_sum_by_item_id_and_year_month_created_at_reducer_1,tpv_by_store_id_and_year_half_created_at_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_1,purchases_qty_by_store_id_and_user_id_reducer_2,purchases_qty_by_store_id_and_user_id_reducer_3,purchases_qty_by_store_id_and_user_id_reducer_4,purchases_qty_by_store_id_and_user_id_reducer_5,desc_by_year_month_created_at_and_sellings_qty_sorter_0,desc_by_year_month_created_at_and_profit_sum_sorter_0,desc_by_store_id_and_purchases_qty_sorter_0,desc_by_store_id_and_purchases_qty_sorter_1,transaction_items_with_menu_items_query_21_joiner_0,transaction_items_with_menu_items_query_22_joiner_0,transaction_items_with_menu_items_query_21_joiner_1,transaction_items_with_menu_items_query_22_joiner_1,transactions_with_stores_query_3x_joiner_0,transactions_with_stores_query_3x_joiner_1,transactions_with_stores_query_4x_joiner_0,transactions_with_stores_query_4x_joiner_1,transactions_with_users_joiner_0,transactions_with_users_joiner_1,transactions_with_users_joiner_2,transactions_with_users_joiner_3,transactions_with_users_joiner_4,transactions_with_users_joiner_5,transactions_with_users_joiner_6,transactions_with_users_joiner_7,query_1x_output_builder_0,query_1x_output_builder_1,query_21_output_builder_0,query_22_output_builder_0,query_3x_output_builder_0,query_4x_output_builder_0
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - HEARTBEAT_INTERVAL_MS=800
      - HEARTBEAT_TIMEOUT_MS=1000
      - NODHEARTBEAT_MAX_RETRIES=5
      - SUSPECT_GRACE_MS=1200
      - LEADER_CHECK_INTERVAL_MS=10000
      - LEADER_CHECK_TIMEOUT_MS=1000
      - ELECTION_BACKOFF_MS_MIN=300
      - ELECTION_BACKOFF_MS_MAX=900
      - LEADER_RANDOM_SLEEP_MIN_MS=1500
      - LEADER_RANDOM_SLEEP_MAX_MS=5000
      - DOCKER_HOST=unix:///var/run/docker.sock
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  hc_1:
    container_name: hc_1
    image: health_checkers:latest
    volumes: 
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ID=1
      - NODE_NAME=hc_1
      - LISTEN_PORT=9101
      - HEALTH_LISTEN_PORT=9201
      - RING_PEERS=hc_0,hc_2,hc_3,hc_4
      - CONTROLLER_TARGETS=server,menu_items_cleaner_0,stores_cleaner_0,transaction_items_cleaner_0,transaction_items_cleaner_1,transactions_cleaner_0,transactions_cleaner_1,users_cleaner_0,users_cleaner_1,filter_transactions_by_year_0,filter_transactions_by_year_1,filter_transactions_by_hour_0,filter_transactions_by_hour_1,filter_transactions_by_hour_2,filter_transactions_by_hour_3,filter_transactions_by_hour_4,filter_transactions_by_hour_5,filter_transactions_by_final_amount_0,filter_transactions_by_final_amount_1,filter_transaction_items_by_year_0,filter_transaction_items_by_year_1,year_month_created_at_transaction_items_mapper_0,year_month_created_at_transaction_items_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,sellings_qty_by_item_id_and_year_month_created_at_reducer_0,profit_sum_by_item_id_and_year_month_created_at_reducer_0,sellings_qty_by_item_id_and_year_month_created_at_reducer_1,profit_sum_by_item_id_and_year_month_created_at_reducer_1,tpv_by_store_id_and_year_half_created_at_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_1,purchases_qty_by_store_id_and_user_id_reducer_2,purchases_qty_by_store_id_and_user_id_reducer_3,purchases_qty_by_store_id_and_user_id_reducer_4,purchases_qty_by_store_id_and_user_id_reducer_5,desc_by_year_month_created_at_and_sellings_qty_sorter_0,desc_by_year_month_created_at_and_profit_sum_sorter_0,desc_by_store_id_and_purchases_qty_sorter_0,desc_by_store_id_and_purchases_qty_sorter_1,transaction_items_with_menu_items_query_21_joiner_0,transaction_items_with_menu_items_query_22_joiner_0,transaction_items_with_menu_items_query_21_joiner_1,transaction_items_with_menu_items_query_22_joiner_1,transactions_with_stores_query_3x_joiner_0,transactions_with_stores_query_3x_joiner_1,transactions_with_stores_query_4x_joiner_0,transactions_with_stores_query_4x_joiner_1,transactions_with_users_joiner_0,transactions_with_users_joiner_1,transactions_with_users_joiner_2,transactions_with_users_joiner_3,transactions_with_users_joiner_4,transactions_with_users_joiner_5,transactions_with_users_joiner_6,transactions_with_users_joiner_7,query_1x_output_builder_0,query_1x_output_builder_1,query_21_output_builder_0,query_22_output_builder_0,query_3x_output_builder_0,query_4x_output_builder_0
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - HEARTBEAT_INTERVAL_MS=800
      - HEARTBEAT_TIMEOUT_MS=1000
      - NODHEARTBEAT_MAX_RETRIES=5
      - SUSPECT_GRACE_MS=1200
      - LEADER_CHECK_INTERVAL_MS=10000
      - LEADER_CHECK_TIMEOUT_MS=1000
      - ELECTION_BACKOFF_MS_MIN=300
      - ELECTION_BACKOFF_MS_MAX=900
      - LEADER_RANDOM_SLEEP_MIN_MS=1500
      - LEADER_RANDOM_SLEEP_MAX_MS=5000
      - DOCKER_HOST=unix:///var/run/docker.sock
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  hc_2:
    container_name: hc_2
    image: health_checkers:latest
    volumes: 
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ID=2
      - NODE_NAME=hc_2
      - LISTEN_PORT=9101
      - HEALTH_LISTEN_PORT=9201
      - RING_PEERS=hc_0,hc_1,hc_3,hc_4
      - CONTROLLER_TARGETS=server,menu_items_cleaner_0,stores_cleaner_0,transaction_items_cleaner_0,transaction_items_cleaner_1,transactions_cleaner_0,transactions_cleaner_1,users_cleaner_0,users_cleaner_1,filter_transactions_by_year_0,filter_transactions_by_year_1,filter_transactions_by_hour_0,filter_transactions_by_hour_1,filter_transactions_by_hour_2,filter_transactions_by_hour_3,filter_transactions_by_hour_4,filter_transactions_by_hour_5,filter_transactions_by_final_amount_0,filter_transactions_by_final_amount_1,filter_transaction_items_by_year_0,filter_transaction_items_by_year_1,year_month_created_at_transaction_items_mapper_0,year_month_created_at_transaction_items_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,sellings_qty_by_item_id_and_year_month_created_at_reducer_0,profit_sum_by_item_id_and_year_month_created_at_reducer_0,sellings_qty_by_item_id_and_year_month_created_at_reducer_1,profit_sum_by_item_id_and_year_month_created_at_reducer_1,tpv_by_store_id_and_year_half_created_at_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_1,purchases_qty_by_store_id_and_user_id_reducer_2,purchases_qty_by_store_id_and_user_id_reducer_3,purchases_qty_by_store_id_and_user_id_reducer_4,purchases_qty_by_store_id_and_user_id_reducer_5,desc_by_year_month_created_at_and_sellings_qty_sorter_0,desc_by_year_month_created_at_and_profit_sum_sorter_0,desc_by_store_id_and_purchases_qty_sorter_0,desc_by_store_id_and_purchases_qty_sorter_1,transaction_items_with_menu_items_query_21_joiner_0,transaction_items_with_menu_items_query_22_joiner_0,transaction_items_with_menu_items_query_21_joiner_1,transaction_items_with_menu_items_query_22_joiner_1,transactions_with_stores_query_3x_joiner_0,transactions_with_stores_query_3x_joiner_1,transactions_with_stores_query_4x_joiner_0,transactions_with_stores_query_4x_joiner_1,transactions_with_users_joiner_0,transactions_with_users_joiner_1,transactions_with_users_joiner_2,transactions_with_users_joiner_3,transactions_with_users_joiner_4,transactions_with_users_joiner_5,transactions_with_users_joiner_6,transactions_with_users_joiner_7,query_1x_output_builder_0,query_1x_output_builder_1,query_21_output_builder_0,query_22_output_builder_0,query_3x_output_builder_0,query_4x_output_builder_0
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - HEARTBEAT_INTERVAL_MS=800
      - HEARTBEAT_TIMEOUT_MS=1000
      - NODHEARTBEAT_MAX_RETRIES=5
      - SUSPECT_GRACE_MS=1200
      - LEADER_CHECK_INTERVAL_MS=10000
      - LEADER_CHECK_TIMEOUT_MS=1000
      - ELECTION_BACKOFF_MS_MIN=300
      - ELECTION_BACKOFF_MS_MAX=900
      - LEADER_RANDOM_SLEEP_MIN_MS=1500
      - LEADER_RANDOM_SLEEP_MAX_MS=5000
      - DOCKER_HOST=unix:///var/run/docker.sock
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  hc_3:
    container_name: hc_3
    image: health_checkers:latest
    volumes: 
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ID=3
      - NODE_NAME=hc_3
      - LISTEN_PORT=9101
      - HEALTH_LISTEN_PORT=9201
      - RING_PEERS=hc_0,hc_1,hc_2,hc_4
      - CONTROLLER_TARGETS=server,menu_items_cleaner_0,stores_cleaner_0,transaction_items_cleaner_0,transaction_items_cleaner_1,transactions_cleaner_0,transactions_cleaner_1,users_cleaner_0,users_cleaner_1,filter_transactions_by_year_0,filter_transactions_by_year_1,filter_transactions_by_hour_0,filter_transactions_by_hour_1,filter_transactions_by_hour_2,filter_transactions_by_hour_3,filter_transactions_by_hour_4,filter_transactions_by_hour_5,filter_transactions_by_final_amount_0,filter_transactions_by_final_amount_1,filter_transaction_items_by_year_0,filter_transaction_items_by_year_1,year_month_created_at_transaction_items_mapper_0,year_month_created_at_transaction_items_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,sellings_qty_by_item_id_and_year_month_created_at_reducer_0,profit_sum_by_item_id_and_year_month_created_at_reducer_0,sellings_qty_by_item_id_and_year_month_created_at_reducer_1,profit_sum_by_item_id_and_year_month_created_at_reducer_1,tpv_by_store_id_and_year_half_created_at_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_1,purchases_qty_by_store_id_and_user_id_reducer_2,purchases_qty_by_store_id_and_user_id_reducer_3,purchases_qty_by_store_id_and_user_id_reducer_4,purchases_qty_by_store_id_and_user_id_reducer_5,desc_by_year_month_created_at_and_sellings_qty_sorter_0,desc_by_year_month_created_at_and_profit_sum_sorter_0,desc_by_store_id_and_purchases_qty_sorter_0,desc_by_store_id_and_purchases_qty_sorter_1,transaction_items_with_menu_items_query_21_joiner_0,transaction_items_with_menu_items_query_22_joiner_0,transaction_items_with_menu_items_query_21_joiner_1,transaction_items_with_menu_items_query_22_joiner_1,transactions_with_stores_query_3x_joiner_0,transactions_with_stores_query_3x_joiner_1,transactions_with_stores_query_4x_joiner_0,transactions_with_stores_query_4x_joiner_1,transactions_with_users_joiner_0,transactions_with_users_joiner_1,transactions_with_users_joiner_2,transactions_with_users_joiner_3,transactions_with_users_joiner_4,transactions_with_users_joiner_5,transactions_with_users_joiner_6,transactions_with_users_joiner_7,query_1x_output_builder_0,query_1x_output_builder_1,query_21_output_builder_0,query_22_output_builder_0,query_3x_output_builder_0,query_4x_output_builder_0
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - HEARTBEAT_INTERVAL_MS=800
      - HEARTBEAT_TIMEOUT_MS=1000
      - NODHEARTBEAT_MAX_RETRIES=5
      - SUSPECT_GRACE_MS=1200
      - LEADER_CHECK_INTERVAL_MS=10000
      - LEADER_CHECK_TIMEOUT_MS=1000
      - ELECTION_BACKOFF_MS_MIN=300
      - ELECTION_BACKOFF_MS_MAX=900
      - LEADER_RANDOM_SLEEP_MIN_MS=1500
      - LEADER_RANDOM_SLEEP_MAX_MS=5000
      - DOCKER_HOST=unix:///var/run/docker.sock
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

  hc_4:
    container_name: hc_4
    image: health_checkers:latest
    volumes: 
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ID=4
      - NODE_NAME=hc_4
      - LISTEN_PORT=9101
      - HEALTH_LISTEN_PORT=9201
      - RING_PEERS=hc_0,hc_1,hc_2,hc_3
      - CONTROLLER_TARGETS=server,menu_items_cleaner_0,stores_cleaner_0,transaction_items_cleaner_0,transaction_items_cleaner_1,transactions_cleaner_0,transactions_cleaner_1,users_cleaner_0,users_cleaner_1,filter_transactions_by_year_0,filter_transactions_by_year_1,filter_transactions_by_hour_0,filter_transactions_by_hour_1,filter_transactions_by_hour_2,filter_transactions_by_hour_3,filter_transactions_by_hour_4,filter_transactions_by_hour_5,filter_transactions_by_final_amount_0,filter_transactions_by_final_amount_1,filter_transaction_items_by_year_0,filter_transaction_items_by_year_1,year_month_created_at_transaction_items_mapper_0,year_month_created_at_transaction_items_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,year_half_created_at_transactions_mapper_0,year_half_created_at_transactions_mapper_1,sellings_qty_by_item_id_and_year_month_created_at_reducer_0,profit_sum_by_item_id_and_year_month_created_at_reducer_0,sellings_qty_by_item_id_and_year_month_created_at_reducer_1,profit_sum_by_item_id_and_year_month_created_at_reducer_1,tpv_by_store_id_and_year_half_created_at_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_0,purchases_qty_by_store_id_and_user_id_reducer_1,purchases_qty_by_store_id_and_user_id_reducer_2,purchases_qty_by_store_id_and_user_id_reducer_3,purchases_qty_by_store_id_and_user_id_reducer_4,purchases_qty_by_store_id_and_user_id_reducer_5,desc_by_year_month_created_at_and_sellings_qty_sorter_0,desc_by_year_month_created_at_and_profit_sum_sorter_0,desc_by_store_id_and_purchases_qty_sorter_0,desc_by_store_id_and_purchases_qty_sorter_1,transaction_items_with_menu_items_query_21_joiner_0,transaction_items_with_menu_items_query_22_joiner_0,transaction_items_with_menu_items_query_21_joiner_1,transaction_items_with_menu_items_query_22_joiner_1,transactions_with_stores_query_3x_joiner_0,transactions_with_stores_query_3x_joiner_1,transactions_with_stores_query_4x_joiner_0,transactions_with_stores_query_4x_joiner_1,transactions_with_users_joiner_0,transactions_with_users_joiner_1,transactions_with_users_joiner_2,transactions_with_users_joiner_3,transactions_with_users_joiner_4,transactions_with_users_joiner_5,transactions_with_users_joiner_6,transactions_with_users_joiner_7,query_1x_output_builder_0,query_1x_output_builder_1,query_21_output_builder_0,query_22_output_builder_0,query_3x_output_builder_0,query_4x_output_builder_0
      - LOGGING_LEVEL=${LOGGING_LEVEL}
      - PYTHONUNBUFFERED=${PYTHONUNBUFFERED}
      - HEARTBEAT_INTERVAL_MS=800
      - HEARTBEAT_TIMEOUT_MS=1000
      - NODHEARTBEAT_MAX_RETRIES=5
      - SUSPECT_GRACE_MS=1200
      - LEADER_CHECK_INTERVAL_MS=10000
      - LEADER_CHECK_TIMEOUT_MS=1000
      - ELECTION_BACKOFF_MS_MIN=300
      - ELECTION_BACKOFF_MS_MAX=900
      - LEADER_RANDOM_SLEEP_MIN_MS=1500
      - LEADER_RANDOM_SLEEP_MAX_MS=5000
      - DOCKER_HOST=unix:///var/run/docker.sock
    networks:
      - custom_net
    depends_on:
      rabbitmq-message-middleware:
        condition: service_healthy

networks:
  custom_net:
    ipam:
      driver: default
      config:
        - subnet: 172.25.125.0/24
